import './polyfills.server.mjs';
import{a as Q}from"./chunk-SLMM3BHI.mjs";import{a as O,b as h,c as M,d as z,e as v,f as s,g as P,h as B,i as J,n as K}from"./chunk-DNVD4XI6.mjs";import{a as j,e as H}from"./chunk-BDCOU3OE.mjs";import{a as L}from"./chunk-BTVMAN4S.mjs";import{a as N}from"./chunk-STLZQXAZ.mjs";import"./chunk-J4BDXTMW.mjs";import{v as $}from"./chunk-3N76YTD7.mjs";import{Ab as T,Hb as l,Mb as V,Ra as m,S as F,X as q,Y as b,aa as X,ab as x,gb as u,ib as _,ka as E,la as k,mb as c,nb as R,ob as I,pb as U,qb as n,rb as t,sb as d,vb as D,zb as S}from"./chunk-7POIXPXD.mjs";import"./chunk-VVCT4QZE.mjs";var W=(()=>{class r{constructor(i){this._HttpClient=i}getUserAddress(){return this._HttpClient.get(`${N.baseURL}/api/v1/addresses`)}addUserAddress(i){return this._HttpClient.post(`${N.baseURL}/api/v1/addresses`,i)}removeUserAddress(i){return this._HttpClient.delete(`${N.baseURL}/api/v1/addresses/${i}`)}static{this.\u0275fac=function(o){return new(o||r)(q($))}}static{this.\u0275prov=F({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function Z(r,p){if(r&1){let i=D();n(0,"div",2)(1,"div",3)(2,"form",4),S("ngSubmit",function(){let e=E(i).$implicit,a=T();return k(a.savedAddressSubmit(e))}),n(3,"div",5)(4,"label",6),l(5,"Name"),t(),d(6,"input",24),t(),n(7,"div",5)(8,"label",9),l(9,"Address Details"),t(),d(10,"input",25),t(),n(11,"div",5),d(12,"label",11)(13,"input",26),t(),n(14,"div",5)(15,"label",18),l(16,"City"),t(),d(17,"input",27),t(),n(18,"div",20)(19,"button",28),S("click",function(){let e,a=E(i).$implicit,f=T();return k(f.removeAddress((e=a.get("_id"))==null?null:e.value))}),l(20,"Delete "),d(21,"i",29),t(),n(22,"button",30),l(23,"Submit"),t()()()()()}if(r&2){let i=p.$implicit;m(2),_("formGroup",i)}}function ee(r,p){r&1&&(n(0,"span",7),l(1,"Name Required"),t())}function te(r,p){r&1&&(n(0,"span",7),l(1,"Address Required"),t())}function ie(r,p){r&1&&(n(0,"span",7),l(1,"Phone Required"),t())}function ne(r,p){r&1&&(n(0,"span",7),l(1,"City required"),t())}function re(r,p){r&1&&(n(0,"span",7),l(1,"Name Required"),t())}function oe(r,p){r&1&&(n(0,"span",7),l(1,"Address Required"),t())}function le(r,p){r&1&&(n(0,"span",7),l(1,"Phone Required"),t())}function se(r,p){r&1&&(n(0,"span",7),l(1,"City required"),t())}var Se=(()=>{class r{constructor(){this._OrderService=b(Q),this._ToastrService=b(L),this._ActivatedRoute=b(j),this._AddressService=b(W),this.FormGroups=x([]),this.CartId=x(""),this.ShippingAddressGroup=new v({name:new s(null,h.required),details:new s(null,h.required),phone:new s(null,h.required),city:new s(null,h.required)}),this.NewAddressGroup=new v({name:new s(null,h.required),details:new s(null,h.required),phone:new s(null,h.required),city:new s(null,h.required)})}ngOnInit(){this._AddressService.getUserAddress().subscribe({next:i=>{for(let o of i.data){let e=new v({_id:new s(o._id),name:new s(o.name),details:new s(o.details),phone:new s(o.phone),city:new s(o.city)});this.FormGroups.update(a=>[e,...a])}}}),this._ActivatedRoute.paramMap.subscribe({next:i=>{let o=i.get("cartId");o!==null&&this.CartId.set(o)}})}addNewAddress(){if(this.NewAddressGroup.invalid)this.NewAddressGroup.setErrors({mismatch:!0}),this.NewAddressGroup.markAllAsTouched();else{let i={city:this.NewAddressGroup.get("city")?.value,details:this.NewAddressGroup.get("details")?.value,name:this.NewAddressGroup.get("name")?.value,phone:this.NewAddressGroup.get("phone")?.value};this._AddressService.addUserAddress(i).subscribe(o=>{if(o.status==="success"){let e=new v({name:new s(i.name),details:new s(i.details),city:new s(i.city),phone:new s(i.phone)});this.FormGroups.update(a=>[e,...a]),this.NewAddressGroup.reset(),this._ToastrService.success(o.message,"Amazon")}})}}removeAddress(i){this._AddressService.removeUserAddress(i).subscribe(o=>{this.FormGroups.set([]);for(let e of o.data){let a=new v({_id:new s(e._id),name:new s(e.name),details:new s(e.details),phone:new s(e.phone),city:new s(e.city)});this.FormGroups.update(f=>[...f,a])}this._ToastrService.success(o.message,"Amazon")})}checkoutSubmit(){if(this.ShippingAddressGroup.invalid)this.ShippingAddressGroup.setErrors({mismatch:!0}),this.ShippingAddressGroup.markAllAsTouched();else{let i={name:this.ShippingAddressGroup.get("name")?.value,details:this.ShippingAddressGroup.get("details")?.value,phone:this.ShippingAddressGroup.get("phone")?.value,city:this.ShippingAddressGroup.get("city")?.value};this._OrderService.checkoutSession(this.CartId(),i).subscribe({next:o=>{o.status==="success"&&window.open(o.session.url,"_self")}})}}savedAddressSubmit(i){let o={name:i.get("name")?.value,details:i.get("details")?.value,phone:i.get("phone")?.value,city:i.get("city")?.value};this._OrderService.checkoutSession(this.CartId(),o).subscribe({next:e=>{e.status==="success"&&window.open(e.session.url,"_self")}})}static{this.\u0275fac=function(o){return new(o||r)}}static{this.\u0275cmp=X({type:r,selectors:[["app-checkout"]],standalone:!0,features:[V],decls:58,vars:12,consts:[[1,"container","my-5"],[1,"row"],[1,"col-md-4"],[1,"border","p-2","m-2","rounded"],[3,"ngSubmit","formGroup"],[1,"my-2"],["for","name",1,"form-label"],[1,"text-danger","mx-2","mt-2"],["id","name","formControlName","name","type","text",1,"form-control"],["for","details",1,"form-label"],["id","details","formControlName","details","type","text",1,"form-control"],["for","phone"],["id","phone","formControlName","phone","placeholder","012 XXX XXX XX","type","tel",1,"form-control"],["for","newCity",1,"form-label"],["formControlName","city","id","newCity","type","text",1,"form-control"],[1,"d-flex","justify-content-end","align-items-center"],["type","submit",1,"btn","d-block","ms-auto","my-3","btn","btn-primary",3,"disabled"],[1,"fa-solid","fa-plus-circle"],["for","city",1,"form-label"],["formControlName","city","type","text",1,"form-control"],[1,"d-flex","justify-content-between","align-items-center"],["routerLink","home",1,"btn","btn-secondary"],[1,"fa-solid","fa-cancel"],["type","submit",1,"btn","d-block","ms-auto","my-3","btn-main",3,"disabled"],["readonly","","formControlName","name","type","text",1,"form-control","bg-body-tertiary"],["readonly","","formControlName","details","type","text",1,"form-control","bg-body-tertiary"],["readonly","","formControlName","phone","placeholder","012 XXX XXX XX","type","tel",1,"form-control","bg-body-tertiary"],["readonly","","formControlName","city","type","text",1,"form-control","bg-body-tertiary"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fa-solid","fa-trash"],["type","submit",1,"btn","d-block","ms-auto","my-3","btn-main"]],template:function(o,e){if(o&1&&(n(0,"section",0)(1,"div",1),I(2,Z,24,1,"div",2,R),n(4,"div",2)(5,"div",3)(6,"form",4),S("ngSubmit",function(){return e.addNewAddress()}),n(7,"div",5)(8,"label",6),l(9,"Name"),t(),u(10,ee,2,0,"span",7),d(11,"input",8),t(),n(12,"div",5)(13,"label",9),l(14,"Address Details"),t(),u(15,te,2,0,"span",7),d(16,"input",10),t(),n(17,"div",5),d(18,"label",11),u(19,ie,2,0,"span",7),d(20,"input",12),t(),n(21,"div",5)(22,"label",13),l(23,"City"),t(),u(24,ne,2,0,"span",7),d(25,"input",14),t(),n(26,"div",15)(27,"button",16),d(28,"i",17),l(29," Add"),t()()()()(),n(30,"div",2)(31,"div",3)(32,"form",4),S("ngSubmit",function(){return e.checkoutSubmit()}),n(33,"div",5)(34,"label",6),l(35,"Name"),t(),u(36,re,2,0,"span",7),d(37,"input",8),t(),n(38,"div",5)(39,"label",9),l(40,"Address Details"),t(),u(41,oe,2,0,"span",7),d(42,"input",10),t(),n(43,"div",5),d(44,"label",11),u(45,le,2,0,"span",7),d(46,"input",12),t(),n(47,"div",5)(48,"label",18),l(49,"City"),t(),u(50,se,2,0,"span",7),d(51,"input",19),t(),n(52,"div",20)(53,"button",21),l(54,"Cancel "),d(55,"i",22),t(),n(56,"button",23),l(57,"Submit"),t()()()()()()()),o&2){let a,f,g,y,C,A,w,G;m(2),U(e.FormGroups()),m(4),_("formGroup",e.NewAddressGroup),m(4),c(10,(a=e.NewAddressGroup.get("name"))!=null&&a.errors&&((a=e.NewAddressGroup.get("name"))!=null&&a.touched)?10:-1),m(5),c(15,(f=e.NewAddressGroup.get("details"))!=null&&f.errors&&((f=e.NewAddressGroup.get("details"))!=null&&f.touched)?15:-1),m(4),c(19,(g=e.NewAddressGroup.get("phone"))!=null&&g.errors&&((g=e.NewAddressGroup.get("phone"))!=null&&g.touched)?19:-1),m(5),c(24,(y=e.NewAddressGroup.get("city"))!=null&&y.errors&&((y=e.NewAddressGroup.get("city"))!=null&&y.touched)?24:-1),m(3),_("disabled",e.NewAddressGroup.invalid),m(5),_("formGroup",e.ShippingAddressGroup),m(4),c(36,(C=e.ShippingAddressGroup.get("name"))!=null&&C.errors&&((C=e.ShippingAddressGroup.get("name"))!=null&&C.touched)?36:-1),m(5),c(41,(A=e.ShippingAddressGroup.get("details"))!=null&&A.errors&&((A=e.ShippingAddressGroup.get("details"))!=null&&A.touched)?41:-1),m(4),c(45,(w=e.ShippingAddressGroup.get("phone"))!=null&&w.errors&&((w=e.ShippingAddressGroup.get("phone"))!=null&&w.touched)?45:-1),m(5),c(50,(G=e.ShippingAddressGroup.get("city"))!=null&&G.errors&&((G=e.ShippingAddressGroup.get("city"))!=null&&G.touched)?50:-1),m(6),_("disabled",e.ShippingAddressGroup.invalid)}},dependencies:[K,P,O,M,z,B,J,H]})}}return r})();export{Se as CheckoutComponent};
